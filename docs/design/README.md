# Проєктування системи

## RESTful архітектура

Додаток або архітектура вважається RESTful, якщо їй притаманні такі характеристики:

1. Стан та функціональність представлені у вигляді ресурсів – це означає, що кожен ресурс має бути доступним через звичайні HTTP-запити GET, POST, PUT або DELETE. Так, якщо хтось хоче отримати файл на сервері, у них має бути можливість відправити GET-запит та отримати файл. Якщо він хоче завантажити файл на сервер, то він повинен мати можливість використовувати POST або PUT-запит. Нарешті, якщо він хоче видалити файл, має бути можливість надіслати запит DELETE.
2. Архітектура клієнт-сервер, відсутність стану (stateless) та підтримка кешування:
    - Клієнт-сервер – звичайна архітектура, де сервером може бути веб-сервер, на якому розміщено програму, а клієнтом – звичайний веб-браузер;
    - Архітектура без збереження стану означає, що стан програми не зберігається у REST. Наприклад, якщо ви видалили ресурс з сервера командою DELETE, навіть при отриманні позитивного коду відповіді немає гарантій, що він дійсно був видалений. Щоб переконатися, що ресурс видалений, необхідно надіслати запит GET. З його допомогою можна запросити ресурси, щоб подивитися, чи є там віддалений.

## Принципи та обмеження RESTful

Архітектура REST ґрунтується на кількох характеристиках, які описані нижче. Будь-який RESTful веб-сервіс повинен відповідати їм, щоб називатися таким. Ці характеристики також відомі як принципи проектування, які слід слідувати під час роботи з RESTful-сервісами.

### RESTful клієнт-сервер

<center style="
    border-radius:4px;
    border: 1px solid #cfd7e6;
    box-shadow: 0 1px 3px 0 rgba(89,105,129,.05), 0 1px 1px 0 rgba(0,0,0,.025);
    padding: 1em;"
>

@startuml
participant client
participant server

client -> server
@enduml

</center>

Це найважливіша вимога REST-архітектури. Воно означає, що на сервері є RESTful веб-сервіс, який надає необхідну функціональність клієнту. При надсиланні клієнтом запиту до веб-сервісу сервер повинен або відхилити його, або прийняти та надати відповідну відповідь.

### Відсутність стану
Ця концепція означає, що завданням клієнта є переконатися, що серверу передаються всі необхідні дані. Це потрібно для того, щоб сервер міг скласти відповідь належним чином. Це проста незалежна послідовність запитань-відповідей. Клієнт ставить запитання, чи сервер відповідає відповідним чином. Потім клієнт ставить інше питання, проте сервер не пам'ятає, що було до цього, тому відповідає на нього незалежно.

### Кеш

<center style="
    border-radius:4px;
    border: 1px solid #cfd7e6;
    box-shadow: 0 1px 3px 0 rgba(89,105,129,.05), 0 1px 1px 0 rgba(0,0,0,.025);
    padding: 1em;"
>

@startuml
participant client
participant cache
participant server

client -> cache
cache -> server
@enduml

</center>

Концепція кеша допомагає нівелювати проблему відсутності стану. Оскільки кожен запит клієнта незалежний за своєю природою, часом клієнт може повторно надіслати будь-який запит. Запит прийде на сервер і сервер надішле відповідь. Це збільшує мережевий трафік. Кеш дозволяє клієнту зберігати раніше відправлені запити та відповіді. Тому при повторному надсиланні запиту він не буде відправлений серверу; натомість необхідні дані будуть взяті з кешу.

### Багатошарова система
Суть цієї концепції полягає в тому, що будь-який додатковий шар на кшталт проміжного (шар, в якому створюється бізнес-логіка; це може бути додатковий сервіс, з яким клієнт взаємодіє до сервера), можна помістити між клієнтом і сервером, на якому розташовується RESTful веб-сервіс. Однак цей шар повинен бути впроваджений прозоро, щоб він не порушив взаємодію клієнта та сервера.

## Опис

Для прикладу будемо створювати наступний API:

|  API | Опис  | Тіло запиту  | Тіло відповіді  |   
|---|---|---|---|
| GET /api/todo | Отримати всі елементи списку справ  | Ні  | Масив списку справ  |   
| GET /api/todo/{id}| Отримати елемент за ідентифікатором  | Ні  | Елемент списку справ  |   
| POST /api/todo  |  Додати новий елемент |Елемент списку справ   |  Елемент списку справ |   
| PUT /api/todo/{id}  | Оновити існуючий елемент  | Елемент списку справ  |  Ні |  
| PATCH /api/todo/{id}  |  Оновити існуючий елемент | Елемент списку справ  |  Ні | 
| DELETE /api/todo/{id}  |  Видалити елемент | Ні  | Ні  | 


Архітектура додатку має наступний вигляд

<center>
    <img src="/architecture.png" style="
    width:60%;
    margin:1em 0;
    border-radius:4px;
    border: 1px solid #cfd7e6;
    box-shadow: 0 1px 3px 0 rgba(89,105,129,.05), 0 1px 1px 0 rgba(0,0,0,.025);
    ">
</center>

- Клієнтом є програмне забезпечення, яке використовує веб-API (браузер, мобільний додаток та інше). У нашому випадку клієнт не створюється. Для тестування програми використовуватиметься Postman.
- **Модель** – це об'єкт, який представляє дані у нашому додатку. У разі єдина модель — це елемент списку справ. Моделі представлені найпростішими класами C# (POCO).
- **Контролер** — це об'єкт, який обробляє запит HTTP і створює відповідь HTTP. У цьому додатку один контролер.
- Для простоти цього матеріалу для роботи програми не буде використовуватися база даних. Натомість елементи списку просто зберігаються у пам'яті. Проте рівень доступу до даних буде увімкнено, щоб показати роздільність веб-API та рівня даних






